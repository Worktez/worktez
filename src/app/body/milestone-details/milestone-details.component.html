<!-- /*********************************************************** 
* Copyright (C) 2022 
* Worktez 
* Author : Sanjay Krishna <sanjaykrishna1203@gmail.com>
*    
* This program is free software; you can redistribute it and/or 
* modify it under the terms of the MIT License 
* 
* This program is distributed in the hope that it will be useful, 
* but WITHOUT ANY WARRANTY; without even the implied warranty of 
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 
* See the MIT License for more details. 
***********************************************************/ -->

<div *ngIf="milestoneDataReady" class="container-fluid">
  <div class="row header">
    <div class="col-8">

    </div>

    <div class="col-3">

      <div class="float-right m-1"><button type="button" id="button" class="btn" (click)="activateAdd()"
          data-toggle="modal" data-target="#exampleModalCenter">
          Add Task
        </button></div>
      <div class="float-right m-1"><button type="button" id="button" class="btn" data-toggle="modal"
          data-target="#createNewTask" (click)="createTask()">
          Create Task
        </button></div>
    </div>

    <div class="col-1">
      <span class="close material-icons float-right" (click)="backToMilestones()">close</span>

    </div>

  </div>
  <hr>

  <div class="row">
    <ng-container>
      <div class="col-md-4">
        <div class="card p-4">
          <h1>{{milestoneData.Title}}</h1>
          <div class="row pt-2">
            <div class="col-md-12 col">
              <h4 class="heading">
                <mat-icon fontSet="material-icons-outlined" class="align-middle">
                  description
                </mat-icon><span class="align-middle lightText"> {{milestoneData.Description}}</span>
              </h4>
            </div>
          </div>
          <div class="row">
            <div class="col-md-5 col">
              <h4 class="heading">
                <mat-icon fontSet="material-icons-outlined" class="align-middle mr-1">
                  group
                </mat-icon><span class="align-middle lightText">{{milestoneData.TeamId}}</span>
              </h4>
              <p>Total Tasks : <span class="lightText">{{totalTasks}}</span></p>
            </div>
            <div class="col-md-7 col">
              <div (click)="showEditMilestone(milestoneData.MilestoneId, 'MilestoneStatus')" id="milestoneStatus">
                <span class="label">Status:</span>
                &nbsp;
                <span class="value" (click)="showEditMilestone( milestoneData.MilestoneId, 'MilestoneStatus')" id="milestoneStatus">
                  <ng-container *ngIf="milestoneIdToEdit == milestoneData.MilestoneId && fieldToEdit == 'MilestoneStatus'; else showMilestoneStatusIcon">
                    <select class="form-control form-control-sm" [(ngModel)]="milestoneData.MilestoneStatus" [ngModelOptions]="{standalone: true}" (change)="editStatus()" (mouseleave)="clickOut()">
                      <option [ngValue]="null" [disabled]="true">Select Milestone Status</option>
                        <ng-container *ngFor="let item of milestoneStatusLabels">
                          <option>{{item}}</option>
                        </ng-container>
                    </select>
                  </ng-container>
                  <ng-template #showMilestoneStatusIcon>
                        <span class="lightText">{{milestoneData.MilestoneStatus}}</span>
                  </ng-template>
                </span>
              </div>
              <p id="completeTaskText">Total Completed Tasks : <span class="lightText">{{totalCompletedTasks}}</span></p>
            </div>
          </div>
          <div class="row">
            <div class="col text-center">
              <span type="button" class="btn align-bottom" id="StartDate">
                  <mat-icon fontSet="material-icons-outlined" class="align-middle">
                    date_range
                  </mat-icon>
                  Start Date: <span id="sprintStartDate">{{ milestoneData.StartDate }}</span> 
              </span>
            </div>
          </div>
          <div class="row">
            <div class="col text-center">
              <span type="button" class="btn align-bottom" id="EndDate">
                <mat-icon fontSet="material-icons-outlined" class="align-middle">
                  date_range
                </mat-icon>
                End Date: <span id="sprintStartDate">{{ milestoneData.EndDate }}</span> 
            </span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-8"  *ngIf="taskDataReady">
        <h1 class="text-center mt-4">Task Tracker</h1>
        <div class="process-wrapper" *ngIf="milestoneService.taskData.length > 0">
          <div id="progress-bar-container">
            <ul>
              <ng-container *ngFor="let item of milestoneService.completedTasks">
                <a (click)="openTaskDetails(item.Id)">
                  <li class="step" [ngStyle]="{'width': setMilestoneWidth()}">
                    <div class="step-inner">{{item.Id}}</div>
                  </li>
                </a>
              </ng-container>
              <ng-container *ngFor="let item of milestoneService.incompleteTasks">
                <a (click)="openTaskDetails(item.Id)">
                  <li class="step" [ngStyle]="{'width': setMilestoneWidth()}">
                    <div class="step-inner">{{item.Id}}</div>
                  </li>
                </a>
              </ng-container>
            </ul>

            <div id="line">
              <div id="line-progress" [ngStyle]="{'width': setProgressWidth()}"></div>
            </div>
          </div>
        </div>
        <div *ngIf="milestoneService.taskData.length == 0">
          <h3 class="text-center pt-5">No Tasks to Show!</h3>
        </div>
      </div>
    </ng-container>
  </div>
    <hr>
      <ng-container *ngIf="milestoneService.taskDataStateObservable">
        <div *ngIf="milestoneService.taskData.length>0">
    <div class=" card d-flex justify-content-center" style="width: 90%; margin: auto; position: relative;">
        <app-data-table [dataForTable]="milestoneService.taskData" [displayColoumns]="displayColoumns" [pageSize]="10"></app-data-table>
    </div>
  </div>
  </ng-container>
  </div>
<app-add-task [allTasks]="allTasks" [milestoneId]="milestoneId" (getTasks)="getTasks()"></app-add-task>
<ng-container *ngIf="showLoader">
  <app-loader></app-loader>
</ng-container>